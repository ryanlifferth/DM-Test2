<div class="card">
  <div class="card-header">
    <h3>Create a new Work File</h3>

    <div class="tab-slider-tabs">
      <span class="tab" [class.active]="viewMode == 'newFileTab'" rel="newFileTab" (click)="viewMode ='newFileTab'">New file</span>
      <span class="tab" [class.active]="viewMode == 'addressSearchTab'" rel="addressSearchTab" (click)="viewMode ='addressSearchTab'"><span class="far fa-search"></span> Address</span>
      <span class="tab" [class.active]="viewMode == 'mlsSearchTab'" rel="mlsSearchTab" (click)="viewMode ='mlsSearchTab'"><span class="far fa-search"></span> MLS</span>
      <span class="tab" [class.active]="viewMode == 'apnSearchTab'" rel="apnSearchTab" (click)="viewMode ='apnSearchTab'"><span class="far fa-search"></span> APN</span>
    </div>
  </div>
  <div class="card-body">

    <div class="tab-slider-container" [ngSwitch]="viewMode">

      <div id="newFileTab" *ngSwitchCase="'newFileTab'" class="new-file {{readyToDrop == true ? 'drop' : ''}}" (drop)="drop($event)" (dragover)="allowDrop($event)" (dragleave)="doneDropping($event)">

        <form id="newFileForm" [formGroup]="newFileForm">
          <div class="form-group">
            <label for="fileName">
              Enter your file name/number
              <span class="required" *ngIf="(newFileForm.controls['fileName'].invalid && newFileForm.controls['fileName'].touched)">required</span>
            </label>
            <input type="text" placeholder="file name/number" formControlName="fileName" />
            <a href="#" onclick="return false;" class="create-file-name">[create one for me]</a>
            <!--<small class="form-text text-muted">That's ok if you don't have one, we can create one for you.</small>-->
          </div>
          <div class="form-group">

            <div class="custom-input-group">
              <label for="formType">
                Select your appraisal type
                <span class="required" *ngIf="(newFileForm.controls['formType'].invalid && newFileForm.controls['formType'].touched)">required</span>
              </label>
              <!--<select formControlName="formType" [value]="1004">
                <option id="1004">1004 URAR - UAD</option>
                <option id="1073">1073</option>
              </select>-->
              <select formControlName="formType">
                <option *ngFor="let type of appraisalFormTypes" [ngValue]="type.value">{{type.text}}</option>
              </select>
            </div>
            <div class="custom-input-group form-vendor">
              <div class="dropdown show">
                <div class="selected-item dropdown-toggle" data-toggle="dropdown">
                  <img src="{{selectedVendorImgSrc}}" alt="{{selectedVendorImgAlt}}" #selectedVendor height="{{selectedVendorImgHeight}}" />
                  <a href="#" onclick="return false;" class="change">[change]</a>
                </div>

                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                  <a class="dropdown-item" (click)="updateVendor($event)">
                    <img src="/assets/images/vendors/alamode.png" alt="a la mode" height="25" />
                  </a>
                  <a class="dropdown-item" (click)="updateVendor($event)">
                    <img src="/assets/images/vendors/aci.png" alt="ACI" width="40" />
                  </a>
                  <a class="dropdown-item" (click)="updateVendor($event)">
                    <img src="/assets/images/vendors/bradford.png" alt="Bradford" height="30" />
                  </a>
                  <a class="dropdown-item" (click)="updateVendor($event)">
                    <img src="/assets/images/vendors/sfrep.png" alt="SFREP" height="18" />
                  </a>
                </div>
              </div>

            </div>

          </div>
          <div class="form-group">
            <label>Open an MLS export file (<i>optional</i>)</label>
            <input type="file" style="background-color: #f2f6fa;" class="file-upload" formControlName="mlsFileUpload" />
          </div>

          <!--<a routerLink="/Subject/" class="btn btn-success btn-go" (click)="validate()">
            Create new file
            <span class="fal fa-arrow-circle-right"></span>
          </a>-->

          <button type="submit" class="btn btn-success btn-go" (click)="validate()">
            Create new file
            <span class="fal fa-arrow-circle-right"></span>
          </button>

        </form>

        <!--<div class="input-group">
          <label>This will be a </label>
          <select name="formType">
            <option id="1004">1004 URAR - UAD</option>
            <option id="1073">1073</option>
          </select>
          <label> appraisal.  I will be exporting to</label>
          <div class="form-vendor"><i>a la mode</i> <span class="change">[change]</span></div>.
          <label>The name/number of this file will be </label>
          <input type="text" name="fileName" />
        </div>-->

      </div>

      <div id="addressSearchTab" class="search-forms" *ngSwitchCase="'addressSearchTab'">
        <h4>Start a new file by retrieving subject property info</h4>

        <form id="addressSearchForm" [formGroup]="addressSearchForm" #addressSearch="ngForm">
          <div class="form-row">
            <div class="form-group col-7">
              <label for="address">
                Address
                <span class="required" *ngIf="(addressSearchForm.controls['address'].invalid && addressSearchForm.controls['address'].touched)">required</span>
              </label>
              <input type="text" placeholder="123 Somewhere Ave" formControlName="address" />
            </div>
            <div class="form-group col">
              <label for="city">
                City
              </label>
              <input type="text" placeholder="Springfield" formControlName="city" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-4">
              <label for="county">
                County
                <span class="required" *ngIf="(addressSearchForm.controls['county'].invalid && addressSearchForm.controls['county'].touched)">required</span>
              </label>
              <select formControlName="county">
                <!--<option *ngFor="let county of countiesJson" [ngValue]="county.CountyName">{{county.CountyName}}</option>-->
                <option *ngFor="let county of countiesJsonAddressSearch" [ngValue]="county.CountyName">{{county.CountyName}}</option>
              </select>
            </div>
            <div class="form-group col">
              <label for="state">
                State
                <span class="required" *ngIf="(addressSearchForm.controls['state'].invalid && addressSearchForm.controls['state'].touched)">required</span>
              </label>
              <select formControlName="state">
                <option *ngFor="let state of stateJson " [ngValue]="state.Abbreviation">{{state.State}}</option>
              </select>
            </div>
            <div class="form-group col">
              <label for="zip">
                Zip
              </label>
              <input type="text" placeholder="12345" formControlName="zip" />
            </div>
          </div>
          <div class="submit search">
            <button type="button" class="btn btn-link btn-sm show-results" (click)="showResults()" *ngIf="hasSearchResultsAddress">
              show search results
            </button>

            <button type="submit" class="btn btn-primary btn-search" (click)="searchValidate(addressSearchForm)" [disabled]="isFormSearching(addressSearchForm)">
              <span class="fal fa-search" *ngIf="!isFormSearching(addressSearchForm)"></span>
              <span *ngIf="!isFormSearching(addressSearchForm)">Search</span>
              <span class="far fa-spinner fa-pulse spinner" *ngIf="isFormSearching(addressSearchForm)"></span>
              <span *ngIf="isFormSearching(addressSearchForm)">Searching...</span>
            </button>
          </div>
        </form>


      </div>

      <div id="mlsSearchTab" class="search-forms" *ngSwitchCase="'mlsSearchTab'">
        <h4>Start a new file by retrieving subject property info</h4>

        <form id="mlsSearchForm" [formGroup]="mlsSearchForm">

          <div class="form-group">
            <label for="mlsNumber">
              MLS Number
              <span class="required" *ngIf="(mlsSearchForm.controls['mlsNumber'].invalid && mlsSearchForm.controls['mlsNumber'].touched)">required</span>
            </label>
            <input type="text" placeholder="MLS Number" formControlName="mlsNumber" />
          </div>
          <div class="submit search">
            <button type="button" class="btn btn-link btn-sm show-results" (click)="showResults()" *ngIf="hasSearchResultsMls">
              show search results
            </button>

            <button type="submit" class="btn btn-primary btn-search" (click)="searchValidate(mlsSearchForm)" [disabled]="isFormSearching(mlsSearchForm)">
              <span class="fal fa-search" *ngIf="!isFormSearching(mlsSearchForm)"></span>
              <span *ngIf="!isFormSearching(mlsSearchForm)">Search</span>
              <span class="far fa-spinner fa-pulse spinner" *ngIf="isFormSearching(mlsSearchForm)"></span>
              <span *ngIf="isFormSearching(mlsSearchForm)">Searching...</span>
            </button>
          </div>

        </form>

      </div>

      <div id="apnSearchTab" class="search-forms" *ngSwitchCase="'apnSearchTab'">
        <h4>Start a new file by retrieving subject property info</h4>

        <form id="apnSearchForm" [formGroup]="apnSearchForm">

          <div class="form-group">
            <label for="apnNumber">
              APN Number
              <span class="required" *ngIf="(apnSearchForm.controls['apnNumber'].invalid && apnSearchForm.controls['apnNumber'].touched)">required</span>
            </label>
            <input type="text" placeholder="APN Number" formControlName="apnNumber" />
          </div>
          <div class="form-row">
            <div class="form-group col-5">
              <label for="state">
                State
                <span class="required" *ngIf="(apnSearchForm.controls['state'].invalid && apnSearchForm.controls['state'].touched)">required</span>
              </label>
              <select formControlName="state">
                <option *ngFor="let state of stateJson" [ngValue]="state.Abbreviation">{{state.State}}</option>
              </select>
            </div>
            <div class="form-group col">
              <label for="county">
                County
                <span class="required" *ngIf="(apnSearchForm.controls['county'].invalid && apnSearchForm.controls['county'].touched)">required</span>
              </label>
              <select formControlName="county">
                <!--<option *ngFor="let county of countiesJson" [ngValue]="county.CountyName">{{county.CountyName}}</option>-->
                <option *ngFor="let county of countiesJsonApnSearch" [ngValue]="county.CountyName">{{county.CountyName}}</option>
              </select>
            </div>
          </div>

          <div class="submit search">
            <button type="button" class="btn btn-link btn-sm show-results" (click)="showResults()" *ngIf="hasSearchResultsApn">
              show search results
            </button>

            <button type="submit" class="btn btn-primary btn-search" (click)="searchValidate(apnSearchForm)" [disabled]="isFormSearching(apnSearchForm)">
              <span class="fal fa-search" *ngIf="!isFormSearching(apnSearchForm)"></span>
              <span *ngIf="!isFormSearching(apnSearchForm)">Search</span>
              <span class="far fa-spinner fa-pulse spinner" *ngIf="isFormSearching(apnSearchForm)"></span>
              <span *ngIf="isFormSearching(apnSearchForm)">Searching...</span>
            </button>
          </div>

        </form>

      </div>

    </div>

    <!-- Modal -->
    <div class="modal fade" id="searchResultsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Property Search Results</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body search-results-modal">
            <div class="results {{showNewFile[i] ? 'active' : ''}}" *ngFor="let result of searchResults; let i = index;">

              <div class="sub-row first">
                <div class="address">
                  <span class="address-line1">
                    {{result.address.addressLine1}}
                    <span *ngIf="result.address.addressLine2">, {{result.address.addressLine2}}</span>
                  </span>
                  <span class="address-line2">
                    {{result.address.city}}, {{result.address.state}}  {{result.address.zip}}
                  </span>
                </div>
                <div class="ids" *ngIf="result.apn">{{result.apn}} <span class="label">apn</span></div>
                <div class="ids" *ngIf="result.mlsNumber">{{result.mlsNumber}} <span class="label">mls num.</span></div>
              </div>

              <div class="sub-row second">

                <div class="info">
                  <span class="item">
                    <span class="label">built in</span>
                    {{result.yearBuilt}}
                  </span>
                  <span class="item" *ngIf="result.lotSize">
                    {{convertToAcres(result.lotSize)}}
                    <span class="label">acres</span>
                  </span>
                  <span class="item">
                    {{result.squareFeet}}
                    <span class="label">sq. ft.</span>
                  </span>
                </div>

                <div class="info">
                  <span class="item">
                    <span class="fal fa-bed fa-lg icon"></span>
                    {{result.bedroomCount}}
                    <span class="label">bedrooms</span>
                  </span>
                  <span class="item">
                    <span class="fal fa-bath fa-lg icon"></span>
                    {{result.bathroomCount}}
                    <span class="label">bathrooms</span>
                  </span>
                </div>

                <div class="info">
                  <span class="item ">
                    <span class="fal fa-building fa-lg icon"></span>
                    {{result.type}}
                  </span>
                  <span class="item">
                    <span class="fal fa-home fa-lg icon"></span>
                    {{result.style}}
                  </span>
                </div>

              </div>

              <div class="select-this d-flex h-100 {{showNewFile[i] ? 'active' : ''}}" (click)="useAsSubject($event, i, selectThis)" #selectThis>
                <span class="fal fa-arrow-circle-right fa-2x icon justify-content-center align-self-center"></span>
                <div class="use">
                  <span class="as">use as</span>
                  <span class="subject">subject</span>
                </div>
              </div>

              <div class="new-file-subject" *ngIf="showNewFile[i]">

                <form id="newFileForm" [formGroup]="newFileForm">
                  <div class="form-row">
                    <div class="form-group col-4">
                      <label for="fileName">
                        file name/number
                      </label>
                      <input type="text" placeholder="file name/number" formControlName="fileName" id="fileName" />
                      <a href="#" onclick="return false;" class="create-file-name">[create one for me]</a>
                      <!--<small class="form-text text-muted">That's ok if you don't have one, we can create one for you.</small>-->
                    </div>
                    <div class="form-group">
                      <label for="formType">
                        appraisal type
                      </label>

                      <select formControlName="formType">
                        <option *ngFor="let type of appraisalFormTypes" [ngValue]="type.value">{{type.text}}</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="formType" class="vendor-label">
                        form vendor
                      </label>

                      <div class="dropdown show">
                        <div class="selected-item dropdown-toggle" data-toggle="dropdown">
                          <img src="{{selectedVendorImgSrc}}" alt="{{selectedVendorImgAlt}}" #selectedVendor height="{{selectedVendorImgHeightResults}}" />
                          <a href="#" onclick="return false;" class="change">[change]</a>
                        </div>

                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                          <a class="dropdown-item" (click)="updateVendor($event)">
                            <img src="/assets/images/vendors/alamode.png" alt="a la mode" height="25" />
                          </a>
                          <a class="dropdown-item" (click)="updateVendor($event)">
                            <img src="/assets/images/vendors/aci.png" alt="ACI" width="40" />
                          </a>
                          <a class="dropdown-item" (click)="updateVendor($event)">
                            <img src="/assets/images/vendors/bradford.png" alt="Bradford" height="30" />
                          </a>
                          <a class="dropdown-item" (click)="updateVendor($event)">
                            <img src="/assets/images/vendors/sfrep.png" alt="SFREP" height="18" />
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>

                  <button type="button" class="close" aria-label="Close" (click)="showNewFile[i] = false">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </form>


              </div>

            </div>
          </div>
          <!--<div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>-->
        </div>
      </div>
    </div>


  </div>
</div>
